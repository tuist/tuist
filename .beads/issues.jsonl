{"id":"tuist-1vj","title":"Handle workflow_job GitHub webhook events","description":"Extend TuistWeb.Webhooks.GitHubController to handle workflow_job events.\n\nAdd handling for x-github-event: workflow_job\n\nActions to handle:\n1. queued - Job waiting for runner\n   - Verify labels match our service\n   - Create RunnerJob record\n   - Enqueue SpawnRunnerWorker\n   \n2. in_progress - Job started on runner\n   - Update job status (for tracking)\n   \n3. completed - Job finished\n   - Update job status\n   - Trigger cleanup if not already done\n\nWebhook payload contains:\n- workflow_job.id, run_id, labels\n- repository.full_name\n- organization.login\n\nSignature verification already handled by existing webhook plug.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:35:17.958757852Z","updated_at":"2025-12-02T11:24:42.436306901Z","closed_at":"2025-12-02T11:24:35.649540133Z","dependencies":[{"issue_id":"tuist-1vj","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.712640977Z","created_by":"daemon"}]}
{"id":"tuist-43e","title":"Implement SpawnRunnerWorker Oban job","description":"Create Oban worker to handle async runner spawning on bare metal hosts.\n\nModule: lib/tuist/runners/workers/spawn_runner_worker.ex\n\nResponsibilities:\n1. Receive job_id from webhook handler\n2. Load job record and find available host\n3. Get GitHub registration token via existing GitHub.App\n4. Execute runner setup on host via SSHClient (configure and start GitHub Actions runner)\n5. Update job status (spawning -\u003e running)\n6. Enqueue MonitorRunnerWorker\n\nError handling:\n- Retry on transient SSH failures (max 3 attempts)\n- Mark job failed if no hosts available\n- Clean up on spawn failure\n\nUse existing Tuist.SSHClient for remote execution.\nFollow patterns from Tuist.VCS.Workers.CommentWorker.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:34:56.870387334Z","updated_at":"2025-12-02T11:46:16.94240245Z","closed_at":"2025-12-02T11:41:31.349766236Z","dependencies":[{"issue_id":"tuist-43e","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.61969495Z","created_by":"daemon"},{"issue_id":"tuist-43e","depends_on_id":"tuist-c8v","type":"blocks","created_at":"2025-12-02T10:37:15.639500938Z","created_by":"daemon"},{"issue_id":"tuist-43e","depends_on_id":"tuist-nfd","type":"blocks","created_at":"2025-12-02T10:37:15.727288819Z","created_by":"daemon"}]}
{"id":"tuist-4c2","title":"Customer onboarding UI for Tuist Runners","description":"Create customer-facing UI for enabling and configuring Tuist Runners.\n\nComponents:\n1. Settings page section\n   - Enable/disable Tuist Runners for organization\n   - View available labels and images\n   - Usage/quota display\n\n2. Documentation integration\n   - Link to docs on workflow configuration\n   - Example workflow YAML snippets\n\n3. Connection flow\n   - Verify GitHub App has required permissions\n   - Prompt to upgrade if needed\n\nLocation: Organization settings page (existing)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-02T10:36:11.521012817Z","updated_at":"2025-12-02T11:05:30.789004536Z","closed_at":"2025-12-02T11:05:30.789004536Z","dependencies":[{"issue_id":"tuist-4c2","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.823048804Z","created_by":"daemon"}]}
{"id":"tuist-6l2","title":"Define runner label schema and customer configuration","description":"Design and implement the label-based runner selection system.\n\nLabel schema:\n- tuist-runners (base label, required)\n- macos-14, macos-15 (OS version)\n- xcode-15, xcode-16 (Xcode version)\n- large, xlarge (resource tier, future)\n\nCustomer configuration in RunnerOrganization:\n- enabled: boolean\n- custom_label_prefix: optional (e.g., 'mycompany-runners')\n- allowed_labels: list of allowed label combinations\n- max_concurrent_jobs: limit per org\n\nLabel matching logic:\n- Job labels must include 'tuist-runners' or org's custom prefix\n- OS/Xcode labels map to golden images\n- Unknown labels are ignored (passthrough to VM)\n\nExample workflow:\nruns-on: [tuist-runners, macos-14, xcode-16]","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-02T10:35:59.738517423Z","updated_at":"2025-12-02T10:35:59.738517423Z"}
{"id":"tuist-7lt","title":"Create Tart VM lifecycle shell scripts","description":"Create shell scripts to be deployed on Mac hosts for VM management:\n\nScripts needed:\n1. spawn-runner.sh\n   - Clone base image (copy-on-write)\n   - Start VM in background\n   - Wait for boot and get IP\n   - Configure GitHub Actions runner with registration token\n   - Start runner with --ephemeral flag\n\n2. cleanup-runner.sh\n   - Stop VM gracefully\n   - Delete VM and free resources\n   - Clean up PID files\n\n3. monitor-runner.sh\n   - Watch for runner process completion\n   - Notify orchestrator via callback webhook\n   - Trigger cleanup\n\n4. health-check.sh\n   - Report host metrics (CPU, memory, disk, VM count)\n   - Verify Tart is operational\n   - Send metrics to orchestrator\n\n5. cleanup-stale-vms.sh\n   - Find VMs running longer than threshold\n   - Force cleanup of orphaned VMs\n\nScripts location: ~/tart-runner/scripts/ on each host","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:34:33.327229729Z","updated_at":"2025-12-02T11:05:16.234424495Z","closed_at":"2025-12-02T11:05:16.234424495Z"}
{"id":"tuist-7py","title":"Implement CleanupRunnerWorker Oban job","description":"Create Oban worker to clean up VMs after job completion.\n\nModule: lib/tuist/runners/workers/cleanup_runner_worker.ex\n\nResponsibilities:\n1. Execute cleanup script on host via SSH\n2. Update host capacity (decrement current_jobs)\n3. Mark job as completed/failed\n4. Log cleanup metrics\n\nError handling:\n- Retry cleanup on SSH failure\n- Force cleanup after max retries\n- Alert on persistent cleanup failures","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:35:09.363988674Z","updated_at":"2025-12-02T11:46:16.943847042Z","closed_at":"2025-12-02T11:41:39.188218225Z","dependencies":[{"issue_id":"tuist-7py","depends_on_id":"tuist-g26","type":"blocks","created_at":"2025-12-02T10:37:15.690529047Z","created_by":"daemon"}]}
{"id":"tuist-9ar","title":"Write user documentation for Tuist Runners","description":"Create user-facing documentation for Tuist Runners.\n\nContent:\n1. Getting Started\n   - What is Tuist Runners\n   - Benefits (ephemeral, secure, fast)\n   - Prerequisites (GitHub App installation)\n\n2. Configuration\n   - Available labels\n   - Workflow YAML examples\n   - Supported Xcode versions\n\n3. Usage\n   - How jobs are picked up\n   - VM lifecycle explanation\n   - Caching considerations\n\n4. Troubleshooting\n   - Common issues\n   - How to report problems\n\nLocation: docs/docs/guides/runners or similar","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-02T10:36:19.152562403Z","updated_at":"2025-12-02T10:36:19.152562403Z"}
{"id":"tuist-aij","title":"Create admin UI for runner host management","description":"Build LiveView admin interface for managing runner infrastructure.\n\nPages needed:\n1. Host list (/admin/runners/hosts)\n   - List all registered Mac hosts\n   - Show status, capacity, current jobs\n   - Add/edit/remove hosts\n\n2. Host detail (/admin/runners/hosts/:id)\n   - Host configuration\n   - Current running VMs\n   - Recent job history\n   - Manual actions (drain, offline, force cleanup)\n\n3. Job list (/admin/runners/jobs)\n   - Recent/active jobs\n   - Filter by status, host, org\n   - Job details and logs\n\n4. Image management (/admin/runners/images)\n   - List golden images per host\n   - Image metadata (OS, Xcode version)\n\nFollow existing admin UI patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T10:35:50.000905406Z","updated_at":"2025-12-02T11:05:25.563103995Z","closed_at":"2025-12-02T11:05:25.563103995Z","dependencies":[{"issue_id":"tuist-aij","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.772891719Z","created_by":"daemon"}]}
{"id":"tuist-c8v","title":"Add GitHub API methods for runner registration","description":"Extend Tuist.GitHub.Client with runner registration token API.\n\nNew functions needed:\n1. get_org_runner_registration_token/2\n   POST /orgs/{org}/actions/runners/registration-token\n   \n2. get_repo_runner_registration_token/3\n   POST /repos/{owner}/{repo}/actions/runners/registration-token\n\nBoth require installation token from GitHub App.\nUse existing GitHub.App.get_installation_token/2.\n\nReturns: %{token: string, expires_at: datetime}\n\nNote: Registration tokens are single-use and expire in 1 hour.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:35:27.017298296Z","updated_at":"2025-12-02T10:43:19.981396866Z","closed_at":"2025-12-02T10:43:19.981396866Z"}
{"id":"tuist-e73","title":"Tuist Runners: GitHub Actions macOS CI product","description":"Epic for implementing Tuist Runners - a GitHub Actions self-hosted macOS runner service. Provides dedicated CI runners for iOS/macOS builds running directly on bare metal Mac hosts.\n\nArchitecture:\n- Orchestrator: Elixir service in @server receiving GitHub workflow_job webhooks\n- Mac Hosts: Manually provisioned Apple Silicon Macs running runners directly (no VMs)\n- Integration: Extends existing GitHub App to handle runner registration\n\nKey features:\n- Direct bare metal execution for maximum performance\n- Multiple Xcode versions via different hosts or host configuration\n- Automatic cleanup after job completion","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-02T10:33:49.891992224Z","updated_at":"2025-12-02T11:05:11.949485691Z"}
{"id":"tuist-g26","title":"Implement MonitorRunnerWorker Oban job","description":"Create Oban worker to monitor running VMs and trigger cleanup.\n\nModule: lib/tuist/runners/workers/monitor_runner_worker.ex\n\nResponsibilities:\n1. Poll VM status via SSH (check runner process)\n2. Re-enqueue self with delay if still running\n3. When runner exits, update job status\n4. Enqueue CleanupRunnerWorker\n5. Handle timeout (max job duration)\n\nConfiguration:\n- Poll interval: 30 seconds\n- Max job duration: 6 hours (configurable)\n- Graceful timeout handling\n\nAlternative approach: VM calls back to orchestrator on completion\n(simpler but requires public webhook endpoint)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:35:03.555545642Z","updated_at":"2025-12-02T11:46:16.944344174Z","closed_at":"2025-12-02T11:42:49.932418523Z","dependencies":[{"issue_id":"tuist-g26","depends_on_id":"tuist-43e","type":"blocks","created_at":"2025-12-02T10:37:15.673167261Z","created_by":"daemon"}]}
{"id":"tuist-i2o","title":"Document Mac host setup and provisioning process","description":"Create documentation for manually provisioning Mac hosts for Tuist Runners.\n\nDocumentation should cover:\n1. Hardware requirements (M1/M2/M4 Pro/Max/Ultra, RAM, storage)\n2. macOS initial setup (hostname, SSH, disable sleep, auto-login)\n3. GitHub Actions runner installation and configuration\n4. Xcode installation and setup\n5. SSH key setup for orchestrator access\n6. Network/firewall requirements\n\nTarget: handbook or internal ops documentation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-02T10:34:22.632892207Z","updated_at":"2025-12-02T11:05:56.310278468Z"}
{"id":"tuist-nfd","title":"Update GitHub App permissions for self-hosted runners","description":"Update existing Tuist GitHub App to include self-hosted runner permissions.\n\nNew permissions needed:\n- Organization: Self-hosted runners (Read \u0026 Write)\n- Repository: Actions (Read \u0026 Write) - if not already present\n\nNew webhook event subscription:\n- workflow_job\n\nSteps:\n1. Update app permissions in GitHub App settings\n2. Request permission upgrade from existing installations\n3. Document new installation flow for customers\n\nNote: Existing installations will need to approve new permissions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T10:35:33.843883042Z","updated_at":"2025-12-02T11:46:16.944776552Z","closed_at":"2025-12-02T11:40:59.988869118Z"}
{"id":"tuist-oqc","title":"Design Tuist Runners data model and Ecto schemas","description":"Design and implement Ecto schemas for the Runners domain:\n\nSchemas needed:\n- RunnerHost: Mac host registration (name, ip, ssh_port, capacity, status, chip_type, ram_gb, storage_gb)\n- RunnerImage: Golden VM images (name, os_version, xcode_version, base_image_name, labels)\n- RunnerJob: Job tracking (github_job_id, run_id, org, repo, labels, status, host_id, vm_name, started_at, completed_at)\n- RunnerOrganization: Customer org settings (account_id, enabled, label_prefix, allowed_labels)\n\nConsiderations:\n- Use UUIDv7 for primary keys\n- Track VM lifecycle states (pending, spawning, running, cleanup, completed, failed)\n- Store GitHub registration tokens securely (encrypted)\n- Index on github_job_id for webhook lookups","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:33:45.62156138Z","updated_at":"2025-12-02T11:11:12.734905546Z","closed_at":"2025-12-02T11:11:12.734905546Z"}
{"id":"tuist-rgd","title":"Add billing/usage tracking for Tuist Runners","description":"Implement usage tracking and billing integration for Tuist Runners.\n\nComponents:\n1. Usage tracking\n   - Track job minutes per organization\n   - Store in existing billing/usage infrastructure\n   - Aggregate by day/month\n\n2. Billing integration\n   - Define runner minutes as billable unit\n   - Integrate with Stripe metered billing\n   - Usage alerts/limits\n\n3. Usage display\n   - Show runner minutes in org dashboard\n   - Historical usage charts\n\nFollow patterns from existing Tuist.Billing module.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-02T10:36:26.736914819Z","updated_at":"2025-12-02T10:36:26.736914819Z","dependencies":[{"issue_id":"tuist-rgd","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.797029687Z","created_by":"daemon"}]}
{"id":"tuist-tb4","title":"Implement Tuist.Runners context module","description":"Create the main Tuist.Runners context module following existing patterns.\n\nModule: lib/tuist/runners.ex\n\nFunctions needed:\n- list_hosts/0 - Get all registered Mac hosts\n- get_available_host/0 - Find host with capacity\n- register_host/1 - Add new Mac host\n- update_host_status/2 - Update host status/capacity\n\n- create_job/1 - Create job record from webhook\n- get_job_by_github_id/1 - Lookup job by GitHub job ID\n- update_job_status/2 - Update job state\n- complete_job/2 - Mark job completed with result\n\n- should_handle_job?/1 - Check if labels match our service\n- get_registration_token/2 - Get GitHub runner registration token\n- spawn_runner/2 - Orchestrate VM spawn on host\n- cleanup_runner/1 - Trigger VM cleanup\n\nFollow patterns from Tuist.VCS, Tuist.Bundles contexts.\nUse Oban for async operations.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T10:34:46.65035359Z","updated_at":"2025-12-02T11:23:08.565208478Z","closed_at":"2025-12-02T11:22:01.424234687Z","dependencies":[{"issue_id":"tuist-tb4","depends_on_id":"tuist-oqc","type":"blocks","created_at":"2025-12-02T10:37:15.592884745Z","created_by":"daemon"}]}
{"id":"tuist-w6r","title":"Security review: runner isolation and secrets handling","description":"Security review for Tuist Runners implementation.\n\nAreas to review:\n1. Runner isolation\n   - Confirm proper cleanup between jobs\n   - Workspace isolation on shared hosts\n\n2. Secrets handling\n   - GitHub registration tokens (encrypted at rest)\n   - SSH keys for host access\n   - No customer secrets stored in orchestrator\n\n3. Host security\n   - SSH hardening on Mac hosts\n   - Firewall rules (only orchestrator can SSH)\n\n4. Multi-tenant isolation\n   - Jobs from different orgs on same host\n   - Resource limits per job/org\n   - Prevent cross-tenant data access\n\nDocument findings and mitigations.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-02T10:36:35.187773996Z","updated_at":"2025-12-02T11:06:15.894124579Z","dependencies":[{"issue_id":"tuist-w6r","depends_on_id":"tuist-43e","type":"blocks","created_at":"2025-12-02T10:37:15.846042346Z","created_by":"daemon"}]}
{"id":"tuist-yg7","title":"Implement host health monitoring and metrics","description":"Add monitoring for Mac hosts and runner jobs.\n\nComponents:\n1. PromEx plugin for runner metrics\n   - runner_jobs_total (counter by status)\n   - runner_job_duration_seconds (histogram)\n   - runner_host_capacity (gauge per host)\n   - runner_host_current_jobs (gauge per host)\n\n2. Host health endpoint\n   - Receive health pings from Mac hosts\n   - Update host status in database\n   - Alert on unhealthy hosts\n\n3. StaleJobCleanupWorker (periodic Oban job)\n   - Find jobs stuck in spawning/running too long\n   - Force cleanup and mark as failed\n   - Run every 15 minutes\n\nFollow patterns from Tuist.Bundles.PromExPlugin","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-02T10:35:41.473595279Z","updated_at":"2025-12-02T11:06:05.338371232Z","dependencies":[{"issue_id":"tuist-yg7","depends_on_id":"tuist-tb4","type":"blocks","created_at":"2025-12-02T10:37:15.745918206Z","created_by":"daemon"}]}
{"id":"tuist-zks","title":"Create golden VM images with Xcode pre-installed","description":"Create and document the golden VM image creation process.\n\nImages to create:\n1. sonoma-xcode15-base (macOS 14 + Xcode 15.x)\n2. sonoma-xcode16-base (macOS 14 + Xcode 16.x)\n3. sequoia-xcode16-base (macOS 15 + Xcode 16.x)\n\nEach image includes:\n- macOS base (from IPSW or Cirrus Labs)\n- Homebrew + common tools\n- Xcode (specific version) + license accepted\n- iOS simulators\n- GitHub Actions runner binary (not configured)\n- Auto-login + SSH enabled\n\nStore images locally on each Mac host.\nDocument image update/rotation process.\n\nConsider using Cirrus Labs pre-built images as starting point:\nghcr.io/cirruslabs/macos-sonoma-xcode:latest","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T10:36:44.318386199Z","updated_at":"2025-12-02T11:05:20.583690652Z","closed_at":"2025-12-02T11:05:20.583690652Z"}
