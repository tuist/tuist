defmodule TuistWeb.RenderAPIErrorPlug do
  @moduledoc ~S"""
  A plug that takes care of formatting the errors generated by open_api_spex to the format expected by the client.
  Docs: https://github.com/open-api-spex/open_api_spex?tab=readme-ov-file#validating-and-casting-params
  """
  use TuistWeb, :controller

  def init(errors), do: errors

  def call(conn, errors) when is_list(errors) do
    conn
    |> put_status(422)
    |> json(%{message: Enum.map_join(errors, "\n", &to_string/1)})
  end
end
