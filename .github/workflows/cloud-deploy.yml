name: Cloud deploy

on:
  push:
    branches:
      - main

concurrency:
  group: cloud-deploy-${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  deploy:
    name: Fly Deploy
    on: [push]
    env:
      FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
    jobs:
      deploy:
          name: Deploy app
          working-directory: projects/cloud
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v2
            - uses: superfly/flyctl-actions/setup-flyctl@master
            - run: flyctl deploy