service: cache
image: tuist/cache

servers:
  web:
    proxy: false
    options:
      network-alias: cache-app

ssh:
  user: github-actions

registry:
  server: ghcr.io
  username: cschmatzler
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64
  context: ..

env:
  clear:
    STORAGE_DIR: /storage
    PHX_SOCKET_PATH: /run/cache/cache.sock
    PHX_SOCKET_LINK: /run/cache/current.sock
    LOKI_URL: http://127.0.0.1:3100

  secret:
    - SECRET_KEY_BASE
    - SENTRY_DSN_CACHE
    - S3_BUCKET
    - S3_HOST
    - S3_ACCESS_KEY_ID
    - S3_SECRET_ACCESS_KEY
    - S3_REGION
    - TUIST_CACHE_API_KEY
    - RELEASE_COOKIE
    - GUARDIAN_SECRET_KEY
    - OBAN_WEB_USERNAME
    - OBAN_WEB_PASSWORD
    - S3_REGISTRY_BUCKET
    - REGISTRY_GITHUB_TOKEN

volumes:
  - /cas:/storage:rw
  - /cas/tmp:/tmp:rw
  - /var/lib/cache:/data:rw
  - /run/cache:/run/cache:rw
  - /etc/hostname:/etc/host_hostname:ro
