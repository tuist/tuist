service: cache
image: tuist/cache

servers:
  web:
    proxy: false
    options:
      network-alias: cache-app

ssh:
  user: github-actions

registry:
  server: ghcr.io
  username: cschmatzler
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64
  context: ..

env:
  clear:
    CAS_STORAGE_DIR: /cas
    PHX_SOCKET_PATH: /run/cache/cache.sock
    PHX_SOCKET_LINK: /run/cache/current.sock

  secret:
    - SECRET_KEY_BASE
    - APPSIGNAL_PUSH_API_KEY
    - S3_BUCKET
    - S3_HOST
    - S3_ACCESS_KEY_ID
    - S3_SECRET_ACCESS_KEY
    - S3_REGION
    - TUIST_CACHE_API_KEY
    - RELEASE_COOKIE
    - GUARDIAN_SECRET_KEY
    - OBAN_WEB_USERNAME
    - OBAN_WEB_PASSWORD

volumes:
  - /cas:/cas:rw
  - /var/lib/cache:/data:rw
  - /run/cache:/run/cache:rw
  - /etc/hostname:/etc/host_hostname:ro
