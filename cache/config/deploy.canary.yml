service: cache
image: tuist/cache

servers:
  web:
    hosts:
      - 23.88.35.139
    proxy: false
    options:
      network-alias: cache-app

registry:
  server: ghcr.io
  username: cschmatzler
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64

env:
  clear:
    SERVER_URL: https://canary.tuist.dev
    CAS_STORAGE_DIR: /cas
    APPSIGNAL_ENV: can
    PHX_SOCKET_PATH: /run/cache/cache.sock
    PHX_SOCKET_LINK: /run/cache/current.sock

  secret:
    - SECRET_KEY_BASE
    - APPSIGNAL_PUSH_API_KEY
    - S3_BUCKET
    - S3_HOST
    - S3_ACCESS_KEY_ID
    - S3_SECRET_ACCESS_KEY
    - S3_REGION

volumes:
  - /cas:/cas:rw
  - /run/cache:/run/cache:rw
  - /etc/hostname:/etc/host_hostname:ro
