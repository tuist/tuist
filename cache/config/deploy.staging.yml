service: cache
image: tuist/cache

servers:
  web:
    hosts:
      - 91.98.81.176
      - 5.161.218.106
    proxy: false
    options:
      network-alias: cache-app
      publish:
        - "127.0.0.1:4000:4000"
        - "127.0.0.1:9091:9091"

registry:
  server: ghcr.io
  username: cschmatzler
  password:
    - KAMAL_REGISTRY_PASSWORD

builder:
  arch: amd64

env:
  clear:
    SERVER_URL: https://staging.tuist.dev
    CAS_STORAGE_DIR: /cas
    APPSIGNAL_ENV: stag
  secret:
    - SECRET_KEY_BASE
    - APPSIGNAL_PUSH_API_KEY
    - S3_BUCKET
    - S3_HOST
    - S3_ACCESS_KEY_ID
    - S3_SECRET_ACCESS_KEY
    - S3_REGION

volumes:
  - /cas:/cas:rw
