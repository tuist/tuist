<%= javascript_pack_tag 'application' %>
<%= stylesheet_link_tag 'tailwind' %>

<%- @omniauth_providers = [] %>
<%- if devise_mapping.omniauthable? %>
  <%- resource_class.omniauth_providers.each do |provider| %>
    <%-
    case provider
    when :github
      logo = "github_logo"
    else
      puts "Unrecognized omniauth provider #{provider}"
    end
    @omniauth_providers.push(
        {
          title: OmniAuth::Utils.camelize(provider),
          link: omniauth_authorize_path(resource_name, provider),
          logo: "github_logo"
        }
    )
    %>
  <% end %>
<% end %>

<section class=" bg-gray-900">
  <div class="flex-col flex items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0">
    <a
      href="/"
      class="flex items-center space-x-4 mb-6 text-2xl font-semibold text-white"
    >
      <%= svg('tuist_cloud_logo', class: "w-8") %>
      <div>Tuist Cloud</div>
    </a>
    <div class="w-full rounded-lg shadow border md:mt-0 sm:max-w-md xl:p-0 bg-gray-800 border-gray-700">
      <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
        <h1 class="text-xl font-bold leading-tight tracking-tight md:text-2xl text-white">
          Welcome
        </h1>
        <p class="text-gray-300 text-sm">
          Using Tuist Cloud requires authentication. Use any of the providers below to authenticate.
        </p>
        <% @omniauth_providers.each do |omniauth_provider| %>
        <a
          href="<%= omniauth_provider[:link] %>"
          data-method="post"
          class="btn-primary"
        >
          <span>
            <%= "Sign in with #{omniauth_provider[:title]}" %>
          </span>
          <%= svg(omniauth_provider[:logo], class: "w-5 h-5 object-contain fill-white") %>
        </a>
        <% end %>

        <% if !@self_hosted %>
          <div class="relative">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t" />
            </div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-gray-800 text-gray-300 font-medium">
              or
            </span>
          </div>
        </div>
        <%= form_with model: resource, as: resource_name, url: session_path(resource_name) do |f| %>
          <div class="mb-4">
            <label for="email" class="block text-sm text-white font-medium mb-2">
              Email
            </label>
            <%= f.text_field :email, class: "form-control input-primary", placeholder: "you@example.com" %>
          </div>
          <div class="mb-4">
            <label for="password" class="block text-sm text-white font-medium mb-2">
              Password
            </label>
            <%= f.password_field :password, class: "form-control input-primary", placeholder: "Enter your password" %>
          </div>
          <%= render "devise/shared/error_messages", resource: resource %>
          <% if alert.present? %>
            <div class="w-full flex flex-col items-start text-white focus:outline-none font-medium rounded-lg text-sm px-5 py-2.5 my-4 text-center bg-red-600" role="alert">
              <%= alert %>
            </div>
          <% end %>
          <div class="mb-6">
            <p class="text-gray-300">
            Don't have an account? <%= link_to "Sign up", new_registration_path(resource_name), class: "text-white" %>
            </p>
          </div>
        <button
          class="btn-primary"
          type="submit"
        >
          <%= f.submit "Sign in" %>
        </button>
      <% end %>
      <% end %>
    </div>
  </div>
</section>
