---
{
  "title": "Authentication",
  "titleTemplate": ":title | Server | Guides | Tuist",
  "description": "Learn how to authenticate with the Tuist server from the CLI."
}
---
# Аутентификация {#authentication}

Для взаимодействия с сервером CLI необходимо аутентифицировать запросы с помощью
[аутентификации
носителя](https://swagger.io/docs/specification/authentication/bearer-authentication/).
CLI поддерживает аутентификацию в качестве пользователя, учетной записи или с
помощью токена OIDC.

## Как пользователь {#as-a-user}

При использовании CLI локально на вашем компьютере мы рекомендуем пройти
аутентификацию как пользователь. Для аутентификации как пользователь необходимо
выполнить следующую команду:

```bash
tuist auth login
```

Команда проведет вас через процесс веб-аутентификации. После аутентификации CLI
сохранит долгосрочный токен обновления и краткосрочный токен доступа в
`~/.config/tuist/credentials`. Каждый файл в каталоге представляет домен, по
которому вы прошли аутентификацию, который по умолчанию должен быть
`tuist.dev.json`. Информация, хранящаяся в этом каталоге, является
конфиденциальной, поэтому **убедитесь, что она находится в безопасности**.

CLI автоматически ищет учетные данные при отправке запросов на сервер. Если
токен доступа истек, CLI использует токен обновления для получения нового токена
доступа.

## Токены OIDC {#oidc-tokens}

Для сред CI, поддерживающих OpenID Connect (OIDC), Tuist может выполнять
аутентификацию автоматически, без необходимости управления секретными данными с
длительным сроком действия. При работе в поддерживаемой среде CI CLI
автоматически обнаруживает поставщика токенов OIDC и обменивает токен,
предоставленный CI, на токен доступа Tuist.

### Поддерживаемые поставщики CI {#supported-ci-providers}

- GitHub Actions
- CircleCI
- Bitrise

### Настройка аутентификации OIDC {#setting-up-oidc-authentication}

1. **Подключите свой репозиторий к Tuist**: Следуйте
   <LocalizedLink href="/guides/integrations/gitforge/github">руководству по
   интеграции GitHub</LocalizedLink>, чтобы подключить свой репозиторий GitHub к
   проекту Tuist.

2. **Запустите `tuist auth login`**: В вашем рабочем процессе CI запустите
   `tuist auth login` перед любыми командами, требующими аутентификации. CLI
   автоматически определит среду CI и выполнит аутентификацию с помощью OIDC.

Примеры конфигурации для конкретных поставщиков см. в
<LocalizedLink href="/guides/integrations/continuous-integration">руководстве по
непрерывной интеграции</LocalizedLink>.

### Области действия токенов OIDC {#oidc-token-scopes}

Токенам OIDC предоставляется группа области `ci`, которая обеспечивает доступ ко
всем проектам, связанным с репозиторием. См. [Группы областей](#scope-groups)
для получения подробной информации о том, что включает область `ci`.

::: tip SECURITY BENEFITS
<!-- -->
Аутентификация OIDC более безопасна, чем долгосрочные токены, потому что:
- Нет секретов по повороту или управлению
- Токены имеют короткий срок действия и привязаны к отдельным запускам рабочего
  процесса.
- Аутентификация привязана к вашей идентичности в репозитории
<!-- -->
:::

## Токены учетной записи {#account-tokens}

Для сред CI, которые не поддерживают OIDC, или когда требуется точный контроль
над разрешениями, можно использовать токены учетной записи. Токены учетной
записи позволяют точно указать, к каким областям и проектам может получить
доступ токен.

### Создание токена учетной записи {#creating-an-account-token}

```bash
tuist account tokens create my-account \
  --scopes project:cache:read project:cache:write \
  --name ci-cache-token \
  --expires 1y
```

Команда принимает следующие опции:

| Вариант     | Описание                                                                                                                                            |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--scopes`  | Обязательно. Разделенный запятыми список областей, в которых будет разрешен токен.                                                                  |
| `--name`    | Обязательно. Уникальный идентификатор токена (1–32 символа, только буквы, цифры, дефисы и подчеркивания).                                           |
| `--expires` | Необязательно. Срок действия токена. Используйте формат `30d` (дни), `6m` (месяцы) или `1y` (годы). Если не указано, токен не имеет срока действия. |
| `--проекты` | Ограничьте токен конкретными дескрипторами проектов. Если токен не указан, он имеет доступ ко всем проектам.                                        |

### Доступные области применения {#available-scopes}

| Область применения       | Описание                                 |
| ------------------------ | ---------------------------------------- |
| `account:members:read`   | Читать членов учетной записи             |
| `account:members:write`  | Управление участниками учетной записи    |
| `account:registry:read`  | Читать из реестра пакетов Swift          |
| `account:registry:write` | Опубликуйте в реестре пакетов Swift      |
| `project:previews:read`  | Скачать предварительный просмотр         |
| `project:previews:write` | Загрузить предварительный просмотр       |
| `project:admin:read`     | Прочитайте настройки проекта             |
| `project:admin:write`    | Управление настройками проекта           |
| `project:cache:read`     | Скачать кэшированные бинарные файлы      |
| `project:cache:write`    | Загрузить кэшированные бинарные файлы    |
| `project:bundles:read`   | Просмотреть пакеты                       |
| `project:bundles:write`  | Загрузить пакеты                         |
| `project:tests:read`     | Прочитайте результаты теста              |
| `project:tests:write`    | Загрузить результаты тестирования        |
| `project:builds:read`    | Читать аналитику сборки                  |
| `project:builds:write`   | Загрузить аналитику сборки               |
| `project:runs:read`      | Команда чтения запускается               |
| `project:runs:write`     | Создание и обновление командных запусков |

### Группы области действия {#scope-groups}

Группы областей действия — это удобный способ присвоить несколько связанных
областей действия с помощью одного идентификатора. При использовании группы
областей действия она автоматически расширяется, включая все отдельные области
действия, которые она содержит.

| Группа области действия | Включенные области                                                                                                                            |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| `ci`                    | `project:cache:write`, `project:previews:write`, `project:bundles:write`, `project:tests:write`, `project:builds:write`, `project:runs:write` |

### Непрерывная интеграция {#continuous-integration}

Для сред CI, которые не поддерживают OIDC, вы можете создать токен учетной
записи с группой области `ci` для аутентификации ваших рабочих процессов CI:

```bash
tuist account tokens create my-account --scopes ci --name ci
```

Это создает токен со всеми областями действия, необходимыми для типичных
операций CI (кэш, предварительный просмотр, пакеты, тесты, сборки и запуски).
Сохраните сгенерированный токен в качестве секрета в вашей среде CI и установите
его в качестве переменной среды `TUIST_TOKEN`.

### Управление токенами учетной записи {#managing-account-tokens}

Чтобы перечислить все токены для учетной записи:

```bash
tuist account tokens list my-account
```

Чтобы отозвать токен по имени:

```bash
tuist account tokens revoke my-account ci-cache-token
```

### Использование токенов учетной записи {#using-account-tokens}

Токены учетной записи должны быть определены как переменные окружения
`TUIST_TOKEN`:

```bash
export TUIST_TOKEN=your-account-token
```

::: tip WHEN TO USE ACCOUNT TOKENS
<!-- -->
Используйте токены учетной записи, когда это необходимо:
- Аутентификация в средах CI, которые не поддерживают OIDC
- Точный контроль над операциями, которые может выполнять токен
- Токен, который может получить доступ к нескольким проектам в рамках одной
  учетной записи
- Токены с ограниченным сроком действия, которые автоматически истекают
<!-- -->
:::
