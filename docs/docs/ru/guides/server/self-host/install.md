---
{
  "title": "Installation",
  "titleTemplate": ":title | Self-hosting | Server | Guides | Tuist",
  "description": "Learn how to install Tuist on your infrastructure."
}
---
# Установка на собственном хостинге {#self-host-installation}

Мы предлагаем самохостируемую версию сервера Tuist для организаций, которым
требуется больший контроль над своей инфраструктурой. Эта версия позволяет
разместить Tuist на вашей собственной инфраструктуре, обеспечивая безопасность и
конфиденциальность ваших данных.

::: warning LICENSE REQUIRED
<!-- -->
Для самостоятельного хостинга Tuist требуется юридически действительная платная
лицензия. Локальная версия Tuist доступна только для организаций, использующих
тарифный план Enterprise. Если вас интересует эта версия, обратитесь по адресу
[contact@tuist.dev](mailto:contact@tuist.dev).
<!-- -->
:::

## Частота выпуска {#release-cadence}

Мы постоянно выпускаем новые версии Tuist по мере появления новых изменений,
готовых к выпуску, в основной версии. Мы следуем [семантическому
версионированию](https://semver.org/), чтобы обеспечить предсказуемое
версионирование и совместимость.

Основной компонент используется для обозначения значительных изменений в сервере
Tuist, которые потребуют координации с локальными пользователями. Вы не должны
ожидать, что мы будем его использовать, и в случае необходимости будьте уверены,
что мы будем работать с вами, чтобы сделать переход плавным.

## Непрерывное развертывание {#continuous-deployment}

Мы настоятельно рекомендуем настроить конвейер непрерывного развертывания,
который будет ежедневно автоматически развертывать последнюю версию Tuist. Это
гарантирует, что у вас всегда будет доступ к новейшим функциям, улучшениям и
обновлениям безопасности.

Вот пример рабочего процесса GitHub Actions, который ежедневно проверяет и
развертывает новые версии:

```yaml
name: Update Tuist Server
on:
  schedule:
    - cron: '0 3 * * *' # Run daily at 3 AM UTC
  workflow_dispatch: # Allow manual runs

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Check and deploy latest version
        run: |
          # Your deployment commands here
          # Example: docker pull ghcr.io/tuist/tuist:latest
          # Deploy to your infrastructure
```

## Требования к рабочей среде {#runtime-requirements}

В этом разделе описаны требования к размещению сервера Tuist в вашей
инфраструктуре.

### Матрица совместимости {#compatibility-matrix}

Сервер Tuist был протестирован и совместим со следующими минимальными версиями:

| Компонент   | Минимальная версия | Примечания                                   |
| ----------- | ------------------ | -------------------------------------------- |
| PostgreSQL  | 15                 | С расширением TimescaleDB                    |
| TimescaleDB | 2.16.1             | Требуемое расширение PostgreSQL (устаревшее) |
| ClickHouse  | 25                 | Требуется для аналитики                      |

::: warning TIMESCALEDB DEPRECATION
<!-- -->
TimescaleDB в настоящее время является обязательным расширением PostgreSQL для
сервера Tuist, используемым для хранения и запроса данных временных рядов.
Однако **TimescaleDB является устаревшим** и в ближайшем будущем будет удалено
из списка обязательных зависимостей, поскольку мы переносим все функции
временных рядов в ClickHouse. На данный момент убедитесь, что на вашем
экземпляре PostgreSQL установлено и включено расширение TimescaleDB.
<!-- -->
:::

### Запуск виртуализированных образов Docker {#running-dockervirtualized-images}

Мы распространяем сервер в виде образа [Docker](https://www.docker.com/) через
[реестр контейнеров
GitHub](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry).

Для запуска ваша инфраструктура должна поддерживать запуск образов Docker.
Обратите внимание, что большинство поставщиков инфраструктуры поддерживают его,
поскольку он стал стандартным контейнером для распространения и запуска
программного обеспечения в производственных средах.

### База данных Postgres {#postgres-database}

Помимо запуска образов Docker, вам понадобится [база данных
Postgres](https://www.postgresql.org/) с [расширением
TimescaleDB](https://www.timescale.com/) для хранения реляционных данных и
данных временных рядов. Большинство поставщиков инфраструктуры включают базы
данных Postgres в свои предложения (например,
[AWS](https://aws.amazon.com/rds/postgresql/) и [Google
Cloud](https://cloud.google.com/sql/docs/postgres)).

**Требуемое расширение TimescaleDB:** Tuist требует расширение TimescaleDB для
эффективного хранения и запроса данных временных рядов. Это расширение
используется для командных событий, аналитики и других функций, основанных на
времени. Перед запуском Tuist убедитесь, что в вашем экземпляре PostgreSQL
установлено и включено расширение TimescaleDB.

::: info MIGRATIONS
<!-- -->
Точка входа образа Docker автоматически запускает все ожидающие миграции схемы
перед запуском службы. Если миграции завершаются сбоем из-за отсутствия
расширения TimescaleDB, вам необходимо сначала установить его в базе данных.
<!-- -->
:::

### База данных ClickHouse {#clickhouse-database}

Tuist использует [ClickHouse](https://clickhouse.com/) для хранения и запроса
больших объемов аналитических данных. ClickHouse — это **, необходимый** для
таких функций, как сбор аналитических данных, и станет основной базой данных
временных рядов по мере отказа от TimescaleDB. Вы можете выбрать, хотите ли вы
самостоятельно хостить ClickHouse или использовать их хостинговый сервис.

::: info MIGRATIONS
<!-- -->
Точка входа образа Docker автоматически запускает все ожидающие миграции схемы
ClickHouse перед запуском службы.
<!-- -->
:::

### Хранение {#storage}

Вам также понадобится решение для хранения файлов (например, бинарных файлов
фреймворков и библиотек). В настоящее время мы поддерживаем любое хранилище,
совместимое с S3.

::: tip OPTIMIZED CACHING
<!-- -->
Если ваша цель в первую очередь состоит в том, чтобы создать собственный
контейнер для хранения двоичных файлов и уменьшить задержку кэша, вам, возможно,
не понадобится самостоятельно хостить весь сервер. Вы можете самостоятельно
хостить узлы кэша и подключать их к хостируемому серверу Tuist или к вашему
собственному серверу.

См. <LocalizedLink href="/guides/cache/self-host">руководство по
самостоятельному хостингу кеша</LocalizedLink>.
<!-- -->
:::

## Конфигурация {#configuration}

Настройка сервиса осуществляется во время выполнения с помощью переменных среды.
Учитывая конфиденциальный характер этих переменных, мы рекомендуем шифровать и
хранить их в безопасных решениях для управления паролями. Будьте уверены, Tuist
обрабатывает эти переменные с максимальной осторожностью, гарантируя, что они
никогда не будут отображаться в журналах.

::: info LAUNCH CHECKS
<!-- -->
Необходимые переменные проверяются при запуске. Если какая-либо из них
отсутствует, запуск не удастся, и в сообщении об ошибке будет указано, какие
переменные отсутствуют.
<!-- -->
:::

### Настройка лицензии {#license-configuration}

Как пользователь локальной версии, вы получите лицензионный ключ, который
необходимо будет указать в качестве переменной среды. Этот ключ используется для
проверки лицензии и обеспечения соответствия работы службы условиям соглашения.

| Переменная среды                   | Описание                                                                                                                                                                                                                                                                                     | Обязательно | По умолчанию | Пример                                    |
| ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------ | ----------------------------------------- |
| `TUIST_LICENSE`                    | Лицензия, предоставляемая после подписания соглашения об уровне обслуживания                                                                                                                                                                                                                 | Да*         |              | `******`                                  |
| `TUIST_LICENSE_CERTIFICATE_BASE64` | **Исключительная альтернатива `TUIST_LICENSE`**. Публичный сертификат с кодировкой Base64 для автономной проверки лицензии в средах с воздушным зазором, где сервер не может связаться с внешними службами. Используйте только в том случае, если `TUIST_LICENSE` не может быть использован. | Да*         |              | `LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...` |

\* Необходимо предоставить либо `TUIST_LICENSE`, либо
`TUIST_LICENSE_CERTIFICATE_BASE64`, но не оба. Для стандартных развертываний
используйте `TUIST_LICENSE`.

::: warning EXPIRATION DATE
<!-- -->
Лицензии имеют срок действия. Пользователи получат предупреждение при
использовании команд Tuist, которые взаимодействуют с сервером, если срок
действия лицензии истекает менее чем через 30 дней. Если вы заинтересованы в
продлении лицензии, обратитесь по адресу
[contact@tuist.dev](mailto:contact@tuist.dev).
<!-- -->
:::

### Базовая настройка среды {#base-environment-configuration}

| Переменная среды                      | Описание                                                                                                                                                                                                                                                   | Обязательно | По умолчанию                       | Пример                                                                       |                                                                                                                                    |
| ------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------- | ---------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| `TUIST_APP_URL`                       | Базовый URL-адрес для доступа к экземпляру из Интернета                                                                                                                                                                                                    | Да          |                                    | https://tuist.dev                                                            |                                                                                                                                    |
| `TUIST_SECRET_KEY_BASE`               | Ключ, используемый для шифрования информации (например, сеансов в файле cookie)                                                                                                                                                                            | Да          |                                    |                                                                              | `c5786d9f869239cbddeca645575349a570ffebb332b64400c37256e1c9cb7ec831345d03dc0188edd129d09580d8cbf3ceaf17768e2048c037d9c31da5dcacfa` |
| `TUIST_SECRET_KEY_PASSWORD`           | Pepper для генерации хэшированных паролей                                                                                                                                                                                                                  | Нет         | `$TUIST_SECRET_KEY_BASE`           |                                                                              |                                                                                                                                    |
| `TUIST_SECRET_KEY_TOKENS`             | Секретный ключ для генерации случайных токенов                                                                                                                                                                                                             | Нет         | `$TUIST_SECRET_KEY_BASE`           |                                                                              |                                                                                                                                    |
| `TUIST_SECRET_KEY_ENCRYPTION`         | 32-байтовый ключ для шифрования конфиденциальных данных с помощью AES-GCM                                                                                                                                                                                  | Нет         | `$TUIST_SECRET_KEY_BASE`           |                                                                              |                                                                                                                                    |
| `TUIST_USE_IPV6`                      | Когда `1`, приложение настраивается на использование адресов IPv6.                                                                                                                                                                                         | Нет         | `0`                                | `1`                                                                          |                                                                                                                                    |
| `TUIST_LOG_LEVEL`                     | Уровень журнала, который следует использовать для приложения                                                                                                                                                                                               | Нет         | `info`                             | [Уровни журнала](https://hexdocs.pm/logger/1.12.3/Logger.html#module-levels) |                                                                                                                                    |
| `TUIST_GITHUB_APP_NAME`               | URL-версия названия вашего приложения GitHub                                                                                                                                                                                                               | Нет         |                                    | `my-app`                                                                     |                                                                                                                                    |
| `TUIST_GITHUB_APP_PRIVATE_KEY_BASE64` | Зашифрованный в base64 закрытый ключ, используемый приложением GitHub для разблокировки дополнительных функций, таких как публикация автоматических комментариев PR.                                                                                       | Нет         | `LS0tLS1CRUdJTiBSU0EgUFJJVkFUR...` |                                                                              |                                                                                                                                    |
| `TUIST_GITHUB_APP_PRIVATE_KEY`        | Частный ключ, используемый приложением GitHub для разблокировки дополнительных функций, таких как публикация автоматических комментариев PR. **Мы рекомендуем использовать версию с кодировкой base64, чтобы избежать проблем со специальными символами.** | Нет         | `-----BEGIN RSA...`                |                                                                              |                                                                                                                                    |
| `TUIST_OPS_USER_HANDLES`              | Разделенный запятыми список дескрипторов пользователей, имеющих доступ к URL-адресам операций.                                                                                                                                                             | Нет         |                                    | `user1,user2`                                                                |                                                                                                                                    |
| `TUIST_WEB`                           | Включите конечную точку веб-сервера                                                                                                                                                                                                                        | Нет         | `1`                                | `1` или `0`                                                                  |                                                                                                                                    |

### Настройка базы данных {#database-configuration}

Для настройки подключения к базе данных используются следующие переменные среды:

| Переменная среды                     | Описание                                                                                                                                                                                                                                  | Обязательно | По умолчанию | Пример                                                                 |
| ------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------ | ---------------------------------------------------------------------- |
| `DATABASE_URL`                       | URL-адрес для доступа к базе данных Postgres. Обратите внимание, что URL-адрес должен содержать информацию для аутентификации.                                                                                                            | Да          |              | `postgres://username:password@cloud.us-east-2.aws.test.com/production` |
| `TUIST_CLICKHOUSE_URL`               | URL-адрес для доступа к базе данных ClickHouse. Обратите внимание, что URL-адрес должен содержать информацию для аутентификации.                                                                                                          | Нет         |              | `http://username:password@cloud.us-east-2.aws.test.com/production`     |
| `TUIST_USE_SSL_FOR_DATABASE`         | Если true, используется [SSL](https://en.wikipedia.org/wiki/Transport_Layer_Security) для подключения к базе данных.                                                                                                                      | Нет         | `1`          | `1`                                                                    |
| `TUIST_DATABASE_POOL_SIZE`           | Количество соединений, которые необходимо оставить открытыми в пуле соединений                                                                                                                                                            | Нет         | `10`         | `10`                                                                   |
| `TUIST_DATABASE_QUEUE_TARGET`        | Интервал (в миллисекундах) для проверки, заняло ли все соединения, проверенные из пула, больше, чем интервал очереди [(Дополнительная информация)](https://hexdocs.pm/db_connection/DBConnection.html#start_link/2-queue-config)          | Нет         | `300`        | `300`                                                                  |
| `TUIST_DATABASE_QUEUE_INTERVAL`      | Пороговое время (в миллисекундах) в очереди, которое пул использует для определения необходимости отказа от новых подключений [(Дополнительная информация)](https://hexdocs.pm/db_connection/DBConnection.html#start_link/2-queue-config) | Нет         | `1000`       | `1000`                                                                 |
| `TUIST_CLICKHOUSE_FLUSH_INTERVAL_MS` | Временной интервал в миллисекундах между очистками буфера ClickHouse                                                                                                                                                                      | Нет         | `5000`       | `5000`                                                                 |
| `TUIST_CLICKHOUSE_MAX_BUFFER_SIZE`   | Максимальный размер буфера ClickHouse в байтах перед принудительной очисткой                                                                                                                                                              | Нет         | `1000000`    | `1000000`                                                              |
| `TUIST_CLICKHOUSE_BUFFER_POOL_SIZE`  | Количество буферных процессов ClickHouse для запуска                                                                                                                                                                                      | Нет         | `5`          | `5`                                                                    |

### Настройка среды аутентификации {#authentication-environment-configuration}

Мы облегчаем аутентификацию с помощью [поставщиков идентификации
(IdP)](https://en.wikipedia.org/wiki/Identity_provider). Чтобы воспользоваться
этой функцией, убедитесь, что все необходимые переменные среды для выбранного
поставщика присутствуют в среде сервера. **Отсутствующие переменные** приведут к
тому, что Tuist обойдет этого поставщика.

#### GitHub {#github}

Мы рекомендуем проходить аутентификацию с помощью [приложения
GitHub](https://docs.github.com/en/apps/creating-github-apps/about-creating-github-apps/about-creating-github-apps),
но вы также можете использовать [приложение
OAuth](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app).
Убедитесь, что в серверной среде указаны все необходимые переменные среды,
определенные GitHub. Отсутствие переменных приведет к тому, что Tuist
проигнорирует аутентификацию GitHub. Чтобы правильно настроить приложение
GitHub:
- В общих настройках приложения GitHub:
    - Скопируйте идентификатор клиента `` и установите его как
      `TUIST_GITHUB_APP_CLIENT_ID`
    - Создайте и скопируйте новый секретный ключ клиента `` и установите его в
      качестве `TUIST_GITHUB_APP_CLIENT_SECRET`
    - Установите URL обратного вызова `` как
      `http://YOUR_APP_URL/users/auth/github/callback`. `YOUR_APP_URL` также
      может быть IP-адресом вашего сервера.
- Требуются следующие разрешения:
  - Репозитории:
    - Запросы на извлечение: чтение и запись
  - Учетные записи:
    - Адреса электронной почты: только для чтения

`В разделе «Разрешения и события» (Permissions and events)` «Учетные записи» (
`) Разрешения учетных записей (Account permissions)` установите для разрешения
«Доступ к учетным записям» ( `) Адреса электронной почты (Email addresses)`
значение «Только для чтения» ( `)`.

Затем вам нужно будет раскрыть следующие переменные среды в среде, в которой
работает сервер Tuist:

| Переменная среды                 | Описание                                | Обязательно | По умолчанию | Пример                                     |
| -------------------------------- | --------------------------------------- | ----------- | ------------ | ------------------------------------------ |
| `TUIST_GITHUB_APP_CLIENT_ID`     | Идентификатор клиента приложения GitHub | Да          |              | `Iv1.a629723000043722`                     |
| `TUIST_GITHUB_APP_CLIENT_SECRET` | Секретный ключ клиента приложения       | Да          |              | `232f972951033b89799b0fd24566a04d83f44ccc` |

#### Google {#google}

Вы можете настроить аутентификацию с помощью Google, используя [OAuth
2](https://developers.google.com/identity/protocols/oauth2). Для этого вам нужно
создать новую учетную запись типа OAuth client ID. При создании учетной записи
выберите «Web Application» в качестве типа приложения, назовите ее `Tuist` и
установите URI перенаправления `{base_url}/users/auth/google/callback`, где
`base_url` — это URL-адрес, по которому работает ваш хостинг-сервис. После
создания приложения скопируйте идентификатор клиента и секретный ключ и
установите их в качестве переменных среды `GOOGLE_CLIENT_ID` и
`GOOGLE_CLIENT_SECRET` соответственно.

::: info CONSENT SCREEN SCOPES
<!-- -->
Возможно, вам понадобится создать экран согласия. При этом обязательно добавьте
области `userinfo.email` и `openid` и отметьте приложение как внутреннее.
<!-- -->
:::

#### Okta {#okta}

Вы можете включить аутентификацию с помощью Okta через протокол [OAuth
2.0](https://oauth.net/2/). Вам нужно будет [создать
приложение](https://developer.okta.com/docs/en/guides/implement-oauth-for-okta/main/#create-an-oauth-2-0-app-in-okta)
в Okta, следуя <LocalizedLink href="/guides/integrations/sso#okta">этим
инструкциям</LocalizedLink>.

После получения идентификатора клиента и секретного ключа во время настройки
приложения Okta вам необходимо будет установить следующие переменные среды:

| Переменная среды             | Описание                                                                                                   | Обязательно | По умолчанию | Пример |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------- | ------------ | ------ |
| `TUIST_OKTA_1_CLIENT_ID`     | Идентификатор клиента для аутентификации в Okta. Этот номер должен быть идентификатором вашей организации. | Да          |              |        |
| `TUIST_OKTA_1_CLIENT_SECRET` | Секретный ключ клиента для аутентификации в Okta                                                           | Да          |              |        |

Номер `1` необходимо заменить на идентификатор вашей организации. Обычно это 1,
но проверьте в своей базе данных.

### Настройка среды хранения {#storage-environment-configuration}

Tuist нуждается в хранилище для размещения артефактов, загруженных через API.
Для эффективной работы Tuist необходимо настроить одно из поддерживаемых решений
для хранения данных **** .

#### Хранилища, совместимые с S3 {#s3compliant-storages}

Для хранения артефактов можно использовать любого поставщика хранилища,
совместимого с S3. Для аутентификации и настройки интеграции с поставщиком
хранилища требуются следующие переменные среды:

| Переменная среды                                         | Описание                                                                                                                                                                | Обязательно | По умолчанию                       | Пример                                                        |
| -------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------- | ------------------------------------------------------------- |
| `TUIST_S3_ACCESS_KEY_ID` или `AWS_ACCESS_KEY_ID`         | Идентификатор ключа доступа для аутентификации у поставщика хранилища                                                                                                   | Да          |                                    | `AKIAIOSFOD`                                                  |
| `TUIST_S3_SECRET_ACCESS_KEY` или `AWS_SECRET_ACCESS_KEY` | Секретный ключ доступа для аутентификации у поставщика хранилища                                                                                                        | Да          |                                    | `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`                    |
| `TUIST_S3_REGION` или `AWS_REGION`                       | Регион, в котором находится ведро                                                                                                                                       | Нет         | `auto`                             | `us-west-2`                                                   |
| `TUIST_S3_ENDPOINT` или `AWS_ENDPOINT`                   | Конечная точка поставщика хранилища                                                                                                                                     | Да          |                                    | `https://s3.us-west-2.amazonaws.com`                          |
| `TUIST_S3_BUCKET_NAME`                                   | Название корзины, в которой будут храниться артефакты                                                                                                                   | Да          |                                    | `tuist-artifacts`                                             |
| `TUIST_S3_CA_CERT_PEM`                                   | Сертификат CA с кодировкой PEM для проверки HTTPS-соединений S3. Полезно для изолированных сред с самоподписанными сертификатами или внутренними центрами сертификации. | Нет         | Пакет System CA                    | `-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----` |
| `TUIST_S3_CONNECT_TIMEOUT`                               | Время ожидания (в миллисекундах) для установления соединения с поставщиком хранилища                                                                                    | Нет         | `3000`                             | `3000`                                                        |
| `TUIST_S3_RECEIVE_TIMEOUT`                               | Таймаут (в миллисекундах) для получения данных от поставщика хранилища                                                                                                  | Нет         | `5000`                             | `5000`                                                        |
| `TUIST_S3_POOL_TIMEOUT`                                  | Время ожидания (в миллисекундах) для пула соединений с поставщиком хранилища. Используйте `infinity` для отсутствия времени ожидания.                                   | Нет         | `5000`                             | `5000`                                                        |
| `TUIST_S3_POOL_MAX_IDLE_TIME`                            | Максимальное время простоя (в миллисекундах) для соединений в пуле. Используйте `infinity`, чтобы соединения оставались активными бесконечно.                           | Нет         | `бесконечность`                    | `60000`                                                       |
| `TUIST_S3_POOL_SIZE`                                     | Максимальное количество подключений на пул                                                                                                                              | Нет         | `500`                              | `500`                                                         |
| `TUIST_S3_POOL_COUNT`                                    | Количество используемых пулов подключений                                                                                                                               | Нет         | Количество системных планировщиков | `4`                                                           |
| `TUIST_S3_PROTOCOL`                                      | Протокол, который следует использовать при подключении к поставщику хранилища (`http1` или `http2`)                                                                     | Нет         | `http1`                            | `http1`                                                       |
| `TUIST_S3_VIRTUAL_HOST`                                  | Должен ли URL-адрес строиться с именем корзины в качестве субдомена (виртуального хоста)?                                                                               | Нет         | `false`                            | `1`                                                           |

::: info AWS authentication with Web Identity Token from environment variables
<!-- -->
Если вашим поставщиком хранилища является AWS и вы хотите пройти аутентификацию
с помощью токена веб-идентификации, вы можете установить переменную среды
`TUIST_S3_AUTHENTICATION_METHOD` в `aws_web_identity_token_from_env_vars`, и
Tuist будет использовать этот метод с помощью стандартных переменных среды AWS.
<!-- -->
:::

#### Google Cloud Storage {#google-cloud-storage}
Для Google Cloud Storage следуйте [этой
документации](https://cloud.google.com/storage/docs/authentication/managing-hmackeys),
чтобы получить пару `AWS_ACCESS_KEY_ID` и `AWS_SECRET_ACCESS_KEY`.
`AWS_ENDPOINT` следует установить на `https://storage.googleapis.com`. Другие
переменные среды такие же, как и для любого другого хранилища, совместимого с
S3.

### Настройка электронной почты {#email-configuration}

Tuist требует функциональности электронной почты для аутентификации
пользователей и уведомлений о транзакциях (например, сброс пароля, уведомления
об учетной записи). В настоящее время **поддерживается только Mailgun** в
качестве поставщика услуг электронной почты.

| Переменная среды                 | Описание                                                                                                                                                                                                 | Обязательно | По умолчанию                                                                           | Пример                    |
| -------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | -------------------------------------------------------------------------------------- | ------------------------- |
| `TUIST_MAILGUN_API_KEY`          | Ключ API для аутентификации с Mailgun                                                                                                                                                                    | Да*         |                                                                                        | `key-1234567890abcdef`    |
| `TUIST_MAILING_DOMAIN`           | Домен, с которого будут отправляться электронные письма                                                                                                                                                  | Да*         |                                                                                        | `mg.tuist.io`             |
| `TUIST_MAILING_FROM_ADDRESS`     | Адрес электронной почты, который будет отображаться в поле «От».                                                                                                                                         | Да*         |                                                                                        | `noreply@tuist.io`        |
| `TUIST_MAILING_REPLY_TO_ADDRESS` | Дополнительный адрес для ответов пользователей                                                                                                                                                           | Нет         |                                                                                        | `support@tuist.dev`       |
| `TUIST_SKIP_EMAIL_CONFIRMATION`  | Пропустить подтверждение по электронной почте для регистрации новых пользователей. При включении этой функции пользователи автоматически подтверждаются и могут войти в систему сразу после регистрации. | Нет         | `true`, если электронная почта не настроена, `false`, если электронная почта настроена | `true`, `false`, `1`, `0` |

\* Переменные настройки электронной почты требуются только в том случае, если вы
хотите отправлять электронные письма. Если они не настроены, подтверждение по
электронной почте автоматически пропускается.

::: info SMTP SUPPORT
<!-- -->
В настоящее время общая поддержка SMTP недоступна. Если вам нужна поддержка SMTP
для локального развертывания, обратитесь по адресу
[contact@tuist.dev](mailto:contact@tuist.dev), чтобы обсудить свои требования.
<!-- -->
:::

::: info AIR-GAPPED DEPLOYMENTS
<!-- -->
Для локальных установок без доступа к Интернету или настройки почтового
провайдера подтверждение по электронной почте по умолчанию автоматически
пропускается. Пользователи могут войти в систему сразу после регистрации. Если у
вас настроена электронная почта, но вы все же хотите пропустить подтверждение,
установите `TUIST_SKIP_EMAIL_CONFIRMATION=true`. Чтобы требовать подтверждение
по электронной почте, когда она настроена, установите
`TUIST_SKIP_EMAIL_CONFIRMATION=false`.
<!-- -->
:::

### Настройка платформы Git {#git-platform-configuration}

Tuist может <LocalizedLink href="/guides/server/authentication">интегрироваться
с платформами Git</LocalizedLink>, чтобы предоставить дополнительные функции,
такие как автоматическая публикация комментариев в ваших запросах на извлечение.

#### GitHub {#platform-github}

` `Вам понадобится [создать приложение
GitHub](https://docs.github.com/en/apps/creating-github-apps/about-creating-github-apps/about-creating-github-apps).
Вы можете повторно использовать приложение, созданное для аутентификации, если
только вы не создали приложение OAuth GitHub. В разделе «Разрешения и события»`
«Разрешения репозитория»` « `» вам необходимо дополнительно установить
разрешение «Pull requests»` « `» «Чтение и запись»`.

В дополнение к `TUIST_GITHUB_APP_CLIENT_ID` и `TUIST_GITHUB_APP_CLIENT_SECRET`
вам понадобятся следующие переменные среды:

| Переменная среды               | Описание                       | Обязательно | По умолчанию | Пример                               |
| ------------------------------ | ------------------------------ | ----------- | ------------ | ------------------------------------ |
| `TUIST_GITHUB_APP_PRIVATE_KEY` | Частный ключ приложения GitHub | Да          |              | `-----BEGIN RSA PRIVATE KEY-----...` |

## Локальное тестирование {#testing-locally}

Мы предоставляем комплексную конфигурацию Docker Compose, которая включает все
необходимые зависимости для тестирования сервера Tuist на вашем локальном
компьютере перед развертыванием в вашей инфраструктуре:

- PostgreSQL 15 с расширением TimescaleDB 2.16 (устаревшее)
- ClickHouse 25 для аналитики
- ClickHouse Keeper для координации
- MinIO для хранилища, совместимого с S3
- Redis для постоянного хранения KV при развертывании (опционально)
- pgweb для администрирования баз данных

::: danger LICENSE REQUIRED
<!-- -->
Для запуска сервера Tuist, включая локальные экземпляры для разработки, по
закону требуется действительная переменная среды `TUIST_LICENSE`. Если вам нужна
лицензия, обратитесь по адресу [contact@tuist.dev](mailto:contact@tuist.dev).
<!-- -->
:::

**Быстрый старт:**

1. Скачайте файлы конфигурации:
   ```bash
   curl -O https://docs.tuist.io/server/self-host/docker-compose.yml
   curl -O https://docs.tuist.io/server/self-host/clickhouse-config.xml
   curl -O https://docs.tuist.io/server/self-host/clickhouse-keeper-config.xml
   curl -O https://docs.tuist.io/server/self-host/.env.example
   ```

2. Настройте переменные среды:
   ```bash
   cp .env.example .env
   # Edit .env and add your TUIST_LICENSE and authentication credentials
   ```

3. Запустите все службы:
   ```bash
   docker compose up -d
   # or with podman:
   podman compose up -d
   ```

4. Доступ к серверу по адресу http://localhost:8080

**Конечные точки службы:**
- Сервер Tuist: http://localhost:8080
- Консоль MinIO: http://localhost:9003 (учетные данные: `tuist` /
  `tuist_dev_password`)
- API MinIO: http://localhost:9002
- pgweb (пользовательский интерфейс PostgreSQL): http://localhost:8081
- Prometheus Metrics: http://localhost:9091/metrics
- ClickHouse HTTP: http://localhost:8124

**Общие команды:**

Проверьте статус услуги:
```bash
docker compose ps
# or: podman compose ps
```

Просмотр журналов:
```bash
docker compose logs -f tuist
```

Остановите службы:
```bash
docker compose down
```

Сбросить все (удалить все данные):
```bash
docker compose down -v
```

**Файлы конфигурации:**
- [docker-compose.yml](/server/self-host/docker-compose.yml) - Завершите
  настройку Docker Compose.
- [clickhouse-config.xml](/server/self-host/clickhouse-config.xml) -
  Конфигурация ClickHouse
- [clickhouse-keeper-config.xml](/server/self-host/clickhouse-keeper-config.xml)
  - Конфигурация ClickHouse Keeper
- [.env.example](/server/self-host/.env.example) - Пример файла переменных среды

## Развертывание {#deployment}

Официальный образ Tuist Docker доступен по адресу:
```
ghcr.io/tuist/tuist
```

### Извлечение образа Docker {#pulling-the-docker-image}

Вы можете получить изображение, выполнив следующую команду:

```bash
docker pull ghcr.io/tuist/tuist:latest
```

Или выберите конкретную версию:
```bash
docker pull ghcr.io/tuist/tuist:0.1.0
```

### Развертывание образа Docker {#deploying-the-docker-image}

Процесс развертывания образа Docker будет отличаться в зависимости от выбранного
вами поставщика облачных услуг и подхода вашей организации к непрерывному
развертыванию. Поскольку большинство облачных решений и инструментов, таких как
[Kubernetes](https://kubernetes.io/), используют образы Docker в качестве
базовых единиц, примеры в этом разделе должны хорошо соответствовать вашей
существующей конфигурации.

::: warning
<!-- -->
Если ваш конвейер развертывания должен проверить, что сервер работает, вы можете
отправить HTTP-запрос `GET` на `/ready` и проверить, что в ответе указан
статус-код `200`.
<!-- -->
:::

#### Fly {#fly}

Для развертывания приложения на [Fly](https://fly.io/) вам понадобится файл
конфигурации `fly.toml`. Рассмотрите возможность его динамического создания в
рамках конвейера непрерывного развертывания (CD). Ниже приведен пример для
использования:

```toml
app = "tuist"
primary_region = "fra"
kill_signal = "SIGINT"
kill_timeout = "5s"

[experimental]
  auto_rollback = true

[env]
  # Your environment configuration goes here
  # Or exposed through Fly secrets

[processes]
  app = "/usr/local/bin/hivemind /app/Procfile"

[[services]]
  protocol = "tcp"
  internal_port = 8080
  auto_stop_machines = false
  auto_start_machines = false
  processes = ["app"]
  http_options = { h2_backend = true }

  [[services.ports]]
    port = 80
    handlers = ["http"]
    force_https = true

  [[services.ports]]
    port = 443
    handlers = ["tls", "http"]
  [services.concurrency]
    type = "connections"
    hard_limit = 100
    soft_limit = 80

  [[services.http_checks]]
    interval = 10000
    grace_period = "10s"
    method = "get"
    path = "/ready"
    protocol = "http"
    timeout = 2000
    tls_skip_verify = false
    [services.http_checks.headers]

[[statics]]
  guest_path = "/app/public"
  url_prefix = "/"
```

Затем вы можете запустить `fly launch --local-only --no-deploy`, чтобы запустить
приложение. При последующих развертываниях вместо запуска `fly launch
--local-only` вам нужно будет запустить `fly deploy --local-only`. Fly.io не
позволяет извлекать частные образы Docker, поэтому нам нужно использовать флаг
`--local-only`.


## Метрики Prometheus {#prometheus-metrics}

Tuist предоставляет метрики Prometheus по адресу `/metrics`, чтобы помочь вам
отслеживать ваш самостоятельно размещенный экземпляр. Эти метрики включают:

### Метрики HTTP-клиента Finch {#finch-metrics}

Tuist использует [Finch](https://github.com/sneako/finch) в качестве
HTTP-клиента и предоставляет подробные метрики о HTTP-запросах:

#### Запросить метрики
- `tuist_prom_ex_finch_request_count_total` - Общее количество запросов Finch
  (счетчик)
  - Метки: `finch_name`, `method`, `scheme`, `host`, `port`, `status`
- `tuist_prom_ex_finch_request_duration_milliseconds` - Продолжительность
  HTTP-запросов (гистограмма)
  - Метки: `finch_name`, `method`, `scheme`, `host`, `port`, `status`
  - Диапазоны: 10 мс, 50 мс, 100 мс, 250 мс, 500 мс, 1 с, 2,5 с, 5 с, 10 с
- `tuist_prom_ex_finch_request_exception_count_total` - Общее количество
  исключений запросов Finch (счетчик)
  - Метки: `finch_name`, `method`, `scheme`, `host`, `port`, `kind`, `reason`

#### Метрики очереди пула подключений
- `tuist_prom_ex_finch_queue_duration_milliseconds` - Время ожидания в очереди
  пула соединений (гистограмма)
  - Метки: `finch_name`, `scheme`, `host`, `port`, `pool`
  - Диапазоны: 1 мс, 5 мс, 10 мс, 25 мс, 50 мс, 100 мс, 250 мс, 500 мс, 1 с
- `tuist_prom_ex_finch_queue_idle_time_milliseconds` - Время, в течение которого
  соединение находилось в режиме ожидания перед использованием (гистограмма)
  - Метки: `finch_name`, `scheme`, `host`, `port`, `pool`
  - Диапазоны: 10 мс, 50 мс, 100 мс, 250 мс, 500 мс, 1 с, 5 с, 10 с
- `tuist_prom_ex_finch_queue_exception_count_total` - Общее количество
  исключений в очереди Finch (счетчик)
  - Метки: `finch_name`, `scheme`, `host`, `port`, `kind`, `reason`

#### Показатели подключения
- `tuist_prom_ex_finch_connect_duration_milliseconds` - Время, затраченное на
  установление соединения (гистограмма)
  - Метки: `finch_name`, `scheme`, `host`, `port`, `error`
  - Диапазоны: 10 мс, 50 мс, 100 мс, 250 мс, 500 мс, 1 с, 2,5 с, 5 с
- `tuist_prom_ex_finch_connect_count_total` - Общее количество попыток
  подключения (счетчик)
  - Метки: `finch_name`, `scheme`, `host`, `port`

#### Отправить метрики
- `tuist_prom_ex_finch_send_duration_milliseconds` - Время, затраченное на
  отправку запроса (гистограмма)
  - Метки: `finch_name`, `method`, `scheme`, `host`, `port`, `error`
  - Диапазоны: 1 мс, 5 мс, 10 мс, 25 мс, 50 мс, 100 мс, 250 мс, 500 мс, 1 с
- `tuist_prom_ex_finch_send_idle_time_milliseconds` - Время, в течение которого
  соединение находилось в режиме ожидания перед отправкой (гистограмма)
  - Метки: `finch_name`, `method`, `scheme`, `host`, `port`, `error`
  - Диапазоны: 1 мс, 5 мс, 10 мс, 25 мс, 50 мс, 100 мс, 250 мс, 500 мс

Все метрики гистограммы предоставляют варианты `_bucket`, `_sum` и `_count` для
детального анализа.

### Другие показатели

В дополнение к метрикам Finch, Tuist предоставляет метрики для:
- Производительность виртуальной машины BEAM
- Пользовательские метрики бизнес-логики (хранилище, учетные записи, проекты и
  т. д.)
- Производительность базы данных (при использовании инфраструктуры, хостируемой
  Tuist)

## Операции {#operations}

Tuist предоставляет набор утилит по адресу `/ops/`, которые вы можете
использовать для управления своим экземпляром.

::: warning Authorization
<!-- -->
Только люди, у которых дескрипторы пользователей указаны в переменной среды
`TUIST_OPS_USER_HANDLES`, могут получить доступ к конечным точкам `/ops/`.
<!-- -->
:::

- **Ошибки (`/ops/errors`):** Вы можете просматривать непредвиденные ошибки,
  которые произошли в приложении. Это полезно для отладки и понимания того, что
  пошло не так, и мы можем попросить вас поделиться этой информацией с нами,
  если у вас возникли проблемы.
- **Панель управления (`/ops/dashboard`):** Вы можете просмотреть панель
  управления, которая предоставляет информацию о производительности и состоянии
  приложения (например, потребление памяти, запущенные процессы, количество
  запросов). Эта панель управления может быть очень полезна для понимания,
  достаточно ли используемого вами оборудования для обработки нагрузки.
