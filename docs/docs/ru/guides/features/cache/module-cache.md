---
{
  "title": "Module cache",
  "titleTemplate": ":title · Cache · Features · Guides · Tuist",
  "description": "Optimize your build times by caching compiled binaries and sharing them across different environments."
}
---

# Кэш модулей {#module-cache}

::: warning ТРЕБОВАНИЯ
<!-- -->
- Проект, созданный
  <LocalizedLink href="/guides/features/projects"></LocalizedLink>
- <LocalizedLink href="/guides/server/accounts-and-projects"> Аккаунт Tuist и
  проект</LocalizedLink>
<!-- -->
:::

Кэш модулей Tuist предоставляет мощный способ оптимизации времени сборки за счет
кэширования модулей в виде двоичных файлов (`.xcframework`) и их совместного
использования в различных средах. Эта возможность позволяет использовать ранее
сгенерированные двоичные файлы, сокращая необходимость в повторной компиляции и
ускоряя процесс разработки.

## Прогрев {#warming}

Tuist эффективно
<LocalizedLink href="/guides/features/projects/hashing">использует
хэши</LocalizedLink> для каждой цели в графе зависимостей, чтобы обнаружить
изменения. Используя эти данные, он создает и присваивает уникальные
идентификаторы двоичным файлам, полученным из этих таргетов. Во время генерации
графа Tuist плавно заменяет исходные цели их соответствующими двоичными
версиями.

Эта операция, известная как *"прогрев,"* создает двоичные файлы для локального
использования или для обмена с товарищами по команде и CI-средой через Tuist.
Процесс прогрева кэша прост и может быть инициирован простой командой:


```bash
tuist cache
```

Команда повторно использует двоичные файлы, чтобы ускорить процесс.

## Использование {#usage}

По умолчанию, когда команды Tuist требуют создания проекта, они автоматически
заменяют зависимости их двоичными эквивалентами из кэша, если они доступны.
Кроме того, если вы укажете список целей, на которых нужно сосредоточиться,
Tuist также заменит все зависимые цели их двоичными файлами из кэша, если они
доступны. Для тех, кто предпочитает другой подход, есть возможность полностью
отказаться от такого поведения, используя специальный флаг:

::: code-group
```bash [Project generation]
tuist generate # Only dependencies
tuist generate Search # Dependencies + Search dependencies
tuist generate Search Settings # Dependencies, and Search and Settings dependencies
tuist generate --cache-profile none # No cache at all
```

```bash [Testing]
tuist test
```
<!-- -->
:::

::: warning
<!-- -->
Двоичное кэширование - это функция, предназначенная для рабочих процессов
разработки, таких как запуск приложения на симуляторе или устройстве, а также
проведение тестов. Она не предназначена для сборки релизов. При архивации
приложения создайте проект с исходными текстами, используя флаг
`--no-binary-cache`.
<!-- -->
:::

## Профили кэша {#cache-profiles}

Tuist поддерживает профили кэша для управления тем, насколько активно таргеты
заменяются кэшированными двоичными файлами при генерации проектов.

- Встроенные функции:
  - `only-external`: заменить только внешние зависимости (по умолчанию)
  - `all-possible`: заменить как можно больше целей (включая внутренние таргеты)
  - `none`: никогда не заменять кэшированными двоичными файлами

Выберите профиль с помощью `--cache-profile` на `tuist generate`:

```bash
# Built-in profiles
tuist generate --cache-profile all-possible

# Custom profiles (defined in Tuist Config)
tuist generate --cache-profile development

# Use config default (no flag)
tuist generate

# Focus on specific targets (implies all-possible)
tuist generate MyModule AnotherTarget

# Disable binary replacement entirely
tuist generate --cache-profile none
```

::: info DEPRECATED FLAG
<!-- -->
Флаг `--no-binary-cache` является устаревшим. Вместо него используйте
`--cache-profile none`. Устаревший флаг по-прежнему работает для обратной
совместимости.
<!-- -->
:::

Приоритет при определении эффективного поведения (от высшего к низшему):

1. `--cache-profile none`
2. Фокус на таргетах (передача таргетов в `generate`) → профиль `all-possible`
3. `--cache-profile &lt; value&gt;`
4. Конфигурация по умолчанию (если установлена)
5. Система по умолчанию (`only-external`)

## Поддерживаемые продукты {#supported-products}

Tuist может кэшировать только следующие целевые продукты:

- Фреймворки (статические и динамические), которые не зависят от
  [XCTest](https://developer.apple.com/documentation/xctest)
- Бандлы
- Макросы Swift

Мы работаем над поддержкой библиотек и целей, которые зависят от XCTest.

::: info ВЫШЕСТОЯЩИЕ ЗАВИСИМОСТИ
<!-- -->
Если таргет не кэшируется, все вышестоящие цели также становятся некэшируемыми.
Например, если у вас есть граф зависимостей `A &gt; B`, где A зависит от B, и B
не кэшируется, то A также не будет кэшироваться.
<!-- -->
:::

## Эффективность {#efficiency}

Уровень эффективности, которого можно достичь с помощью бинарного кэширования,
сильно зависит от структуры графа. Для достижения наилучших результатов мы
рекомендуем следующее:

1. Избегайте сильно вложенных графов зависимостей. Чем мельче граф, тем лучше.
2. Определяйте зависимости через цели с протоколами/интерфейсами, а не через
   реализации, и внедряйте зависимости от самых верхних целей.
3. Разделите часто изменяемые таргеты на более мелкие, вероятность изменения
   которых ниже.

Приведенные выше рекомендации являются частью
<LocalizedLink href="/guides/features/projects/tma-architecture">Модульной
архитектуры</LocalizedLink>, которую мы предлагаем в качестве способа
структурировать ваши проекты, чтобы максимально использовать не только
преимущества двоичного кэширования, но и возможности Xcode.

## Рекомендуемая настройка {#recommended-setup}

Мы рекомендуем иметь задание CI, которое **запускается при каждом коммите в
основной ветке** для прогрева кэша. Это обеспечит постоянное наличие в кэше
двоичных файлов для изменений в `main`, чтобы локальная и CI ветки собирались на
их основе инкрементально.

::: tip ИСПОЛЬЗОВАНИЕ БИНАРНЫХ ФАЙЛОВ ПРИ ПРОГРЕВЕ КЭША
<!-- -->
Команда `tuist cache` также использует двоичный кэш для ускорения прогрева.
<!-- -->
:::

Ниже приведены примеры распространенных воркфлоу:

### Разработчик начинает работать над новой функцией {#a-developer-starts-to-work-on-a-new-feature}

1. Создаёт новую ветку от `main `.
2. Запускает `tuist generate`.
3. Tuist извлекает самые последние двоичные файлы из `main` и генерирует с их
   помощью проект.

### Разработчик отправляет изменения в upstream-репозиторий {#a-developer-pushes-changes-upstream}

1. CI-пайплайн запустит `xcodebuild build` или `tuist test` для сборки или
   тестирования проекта.
2. Воркфлоу будет извлекать самые последние двоичные файлы из `main` и
   генерировать проект с их помощью.
3. Затем он будет собирать или тестировать проект постепенно.

## Конфигурация {#configuration}

### Ограничение параллельных операций с кэшем {#cache-concurrency-limit}

По умолчанию Tuist загружает и отправляет артефакты кэша без ограничения
параллелизма, что позволяет максимально увеличить пропускную способность. Вы
можете управлять этим поведением с помощью переменной окружения
`TUIST_CACHE_CONCURRENCY_LIMIT`:

```bash
# Set a specific concurrency limit
export TUIST_CACHE_CONCURRENCY_LIMIT=10
tuist generate

# Use "none" for no limit (default behavior)
export TUIST_CACHE_CONCURRENCY_LIMIT=none
tuist generate
```

Это может быть полезно в средах с ограниченной пропускной способностью сети или
для снижения нагрузки на систему во время операций с кэшем.

## Устранение неполадок {#troubleshooting}

### Для моих таргетов не используются бинарные файлы {#it-doesnt-use-binaries-for-my-targets}

Убедитесь, что
<LocalizedLink href="/guides/features/projects/hashing#debugging">хэши
детерминированы</LocalizedLink> во всех окружениях и при всех запусках.
Недетерминизм может возникать, если проект содержит ссылки на окружение,
например абсолютные пути. Вы можете использовать команду `diff`, чтобы сравнить
проекты, сгенерированные двумя последовательными запусками `tuist generate`, а
также между разными окружениями или запусками.

Также убедитесь, что таргет не зависит прямо или косвенно от
<LocalizedLink href="/guides/features/cache/generated-project#supported-products">некэшируемого
таргета</LocalizedLink>.

### Отсутствующие символы {#missing-symbols}

При использовании исходного кода система сборки Xcode через Derived Data может
разрешать зависимости, которые не объявлены явно. Однако при использовании
бинарного кэша все зависимости должны быть объявлены явно. В противном случае
вы, скорее всего, столкнётесь с ошибками компиляции из-за отсутствующих
символов. Для отладки мы рекомендуем использовать команду
<LocalizedLink href="/guides/features/projects/inspect/implicit-dependencies">`tuist
inspect implicit-imports`</LocalizedLink> и настроить её запуск в CI, чтобы
предотвращать регрессии, связанные с неявным связыванием.

### Кэш устаревшего модуля {#legacy-module-cache}

В Tuist `4.128.0` мы сделали нашу новую инфраструктуру для кэша модулей
стандартной. Если у вас возникли проблемы с этой новой версией, вы можете
вернуться к прежнему поведению кэша, установив переменную среды
`TUIST_LEGACY_MODULE_CACHE`.

Этот устаревший модуль кэша является временной мерой и будет удален на стороне
сервера в одном из будущих обновлений. Планируйте его миграцию.

```bash
export TUIST_LEGACY_MODULE_CACHE=1
tuist generate
```
